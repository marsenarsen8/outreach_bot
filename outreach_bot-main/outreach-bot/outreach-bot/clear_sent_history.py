import sqlite3
import os

def clear_and_setup_test():
    """–û—á–∏—â–∞–µ—Ç –±–∞–∑—É –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º"""
    db_path = 'outreach_bot.db'
    
    try:
        conn = sqlite3.connect(db_path)
        cursor = conn.cursor()
        
        print("üßπ –û—á–∏—â–∞–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö...")
        
        # –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É results (–≤–∫–ª—é—á–∞—è –∑–∞–ø–∏—Å–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞)
        cursor.execute("DELETE FROM results WHERE user_id = '77474582511'")
        print("‚úÖ –ó–∞–ø–∏—Å–∏ SENT –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞ —É–¥–∞–ª–µ–Ω—ã")
        
        # –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É contacts, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã–π –Ω–æ–º–µ—Ä
        cursor.execute("DELETE FROM contacts WHERE phone != '77474582511'")
        print("‚úÖ –ö–æ–Ω—Ç–∞–∫—Ç—ã –æ—á–∏—â–µ–Ω—ã, –æ—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã–π –Ω–æ–º–µ—Ä")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç
        cursor.execute("SELECT * FROM contacts WHERE phone = '77474582511'")
        test_contact = cursor.fetchone()
        
        if test_contact:
            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ TEST
            cursor.execute("UPDATE contacts SET status = 'TEST' WHERE phone = '77474582511'")
            print("‚úÖ –°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ TEST")
        else:
            # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç
            cursor.execute("""
                INSERT INTO contacts (phone, name, telegram_id, status) 
                VALUES ('77474582511', '–¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç', '77474582511', 'TEST')
            """)
            print("‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç –¥–æ–±–∞–≤–ª–µ–Ω")
        
        # –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É dialogs (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
        try:
            cursor.execute("DELETE FROM dialogs")
            print("‚úÖ –¢–∞–±–ª–∏—Ü–∞ dialogs –æ—á–∏—â–µ–Ω–∞")
        except:
            print("‚ÑπÔ∏è –¢–∞–±–ª–∏—Ü–∞ dialogs –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
        
        # –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É prompts (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
        try:
            cursor.execute("DELETE FROM prompts")
            print("‚úÖ –¢–∞–±–ª–∏—Ü–∞ prompts –æ—á–∏—â–µ–Ω–∞")
            
            # –î–æ–±–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç
            cursor.execute("""
                INSERT INTO prompts (name, content, is_active) 
                VALUES ('–ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç', '–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É.', 1)
            """)
            print("‚úÖ –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –¥–æ–±–∞–≤–ª–µ–Ω")
        except:
            print("‚ÑπÔ∏è –¢–∞–±–ª–∏—Ü–∞ prompts –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
        
        conn.commit()
        conn.close()
        
        print("\n‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!")
        print("üì± –¢–µ—Å—Ç–æ–≤—ã–π –Ω–æ–º–µ—Ä: 77474582511")
        print("üîß –°—Ç–∞—Ç—É—Å: TEST (–Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ SENT)")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")

if __name__ == "__main__":
    clear_and_setup_test() 